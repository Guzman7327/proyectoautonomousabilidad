<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Guardar Destino Turístico</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <main id="main-content" role="main">
    <div class="modal-content registro-modal" style="max-width:600px;margin:2rem auto;box-shadow:0 0 10px #0002;">
      <h2>Guardar Registro</h2>
      <form id="form-guardar" role="form" aria-describedby="guardar-descripcion" autocomplete="on">
        <p id="guardar-descripcion" class="sr-only">Formulario para guardar un nuevo registro</p>
        <fieldset>
          <legend>Datos principales</legend>
          <div class="form-group">
            <label for="nombre">Nombre *</label>
            <input type="text" id="nombre" name="nombre" required autocomplete="name" aria-describedby="nombre-error" />
            <div id="nombre-error" class="error-message" role="alert" aria-live="polite"></div>
          </div>
          <div class="form-group">
            <label for="email">Correo electrónico *</label>
            <input type="email" id="email" name="email" required autocomplete="email" aria-describedby="email-error" />
            <div id="email-error" class="error-message" role="alert" aria-live="polite"></div>
          </div>
          <div class="form-group">
            <label for="fecha">Fecha *</label>
            <input type="date" id="fecha" name="fecha" required aria-describedby="fecha-error" />
            <div id="fecha-error" class="error-message" role="alert" aria-live="polite"></div>
          </div>
          <div class="form-group">
            <label for="ciudad">Ciudad *</label>
            <input type="text" id="ciudad" name="ciudad" required autocomplete="address-level2" aria-describedby="ciudad-error" />
            <div id="ciudad-error" class="error-message" role="alert" aria-live="polite"></div>
          </div>
          <div class="form-group">
            <label for="pais">País *</label>
            <select id="pais" name="pais" required aria-describedby="pais-error">
              <option value="">Seleccione un país</option>
              <option value="Ecuador">Ecuador</option>
              <option value="Colombia">Colombia</option>
              <option value="Perú">Perú</option>
              <option value="Otro">Otro</option>
            </select>
            <div id="pais-error" class="error-message" role="alert" aria-live="polite"></div>
          </div>
        </fieldset>
        <fieldset>
          <legend>Preferencias</legend>
          <div class="form-group">
            <label for="suscripcion">¿Desea recibir notificaciones?</label>
            <input type="checkbox" id="suscripcion" name="suscripcion" />
          </div>
        </fieldset>
        <div class="form-actions">
          <button type="button" onclick="confirmarGuardar()" aria-label="Guardar">Guardar</button>
          <button type="button" onclick="guardarBorrador()" aria-label="Guardar borrador">Guardar borrador</button>
          <button type="button" onclick="window.location.href='/'" aria-label="Cancelar">Cancelar</button>
        </div>
        <div id="guardar-exito" class="registro-exito" role="status" aria-live="polite" style="display:none; color:green; font-weight:bold; margin-top:1em;">¡Registro guardado exitosamente!</div>
        <div id="guardar-error" class="registro-error" role="alert" aria-live="polite" style="display:none; color:red; font-weight:bold; margin-top:1em;"></div>
        <div id="guardar-borrador" class="registro-exito" role="status" aria-live="polite" style="display:none; color:blue; font-weight:bold; margin-top:1em;">¡Borrador guardado!</div>
      </form>
    </div>
  </main>
<script>
// Validación en tiempo real
function validarCampo(id, validador, mensaje) {
  const input = document.getElementById(id);
  const error = document.getElementById(id + '-error');
  if (!validador(input.value)) {
    error.textContent = mensaje;
    input.style.borderColor = 'red';
    return false;
  } else {
    error.textContent = '';
    input.style.borderColor = 'green';
    return true;
  }
}

const form = document.getElementById('form-guardar');
form.addEventListener('input', function(e) {
  if (e.target.id === 'nombre') validarCampo('nombre', v => v.length > 1, 'Nombre requerido');
  if (e.target.id === 'email') validarCampo('email', v => /.+@.+\..+/.test(v), 'Correo inválido');
  if (e.target.id === 'fecha') validarCampo('fecha', v => v.length > 0, 'Fecha requerida');
  if (e.target.id === 'ciudad') validarCampo('ciudad', v => v.length > 1, 'Ciudad requerida');
  if (e.target.id === 'pais') validarCampo('pais', v => v.length > 0, 'Seleccione un país');
});

function mostrarError(mensaje) {
  const error = document.getElementById('guardar-error');
  error.textContent = mensaje;
  error.style.display = 'block';
  setTimeout(() => { error.style.display = 'none'; }, 4000);
}

function mostrarExito() {
  document.getElementById('guardar-exito').style.display = 'block';
  setTimeout(() => { document.getElementById('guardar-exito').style.display = 'none'; }, 3000);
}

function mostrarBorrador() {
  document.getElementById('guardar-borrador').style.display = 'block';
  setTimeout(() => { document.getElementById('guardar-borrador').style.display = 'none'; }, 3000);
}

function confirmarGuardar() {
  if (!validarCampo('nombre', v => v.length > 1, 'Nombre requerido') ||
      !validarCampo('email', v => /.+@.+\..+/.test(v), 'Correo inválido') ||
      !validarCampo('fecha', v => v.length > 0, 'Fecha requerida') ||
      !validarCampo('ciudad', v => v.length > 1, 'Ciudad requerida') ||
      !validarCampo('pais', v => v.length > 0, 'Seleccione un país')) {
    mostrarError('Por favor, corrige los errores antes de guardar.');
    return;
  }
  if (!confirm('¿Desea guardar el registro?')) return;
  // Simulación de guardado exitoso
  mostrarExito();
  form.reset();
}

function guardarBorrador() {
  // Simulación de guardado de borrador
  mostrarBorrador();
}

// Alerta si el usuario intenta salir sin guardar
let formChanged = false;
form.addEventListener('change', () => { formChanged = true; });
window.addEventListener('beforeunload', function (e) {
  if (formChanged) {
    e.preventDefault();
    e.returnValue = '';
  }
});
</script>
</body>
</html> 