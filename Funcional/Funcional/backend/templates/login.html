<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar Sesi√≥n - Portal Tur√≠stico Ecuador</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
  
  <header role="banner">
    <div class="header-container">
      <a href="/" class="logo">
        <img src="{{ url_for('static', filename='img/logo-ecuador.png') }}" alt="Logo oficial de Ecuador Turismo" class="logo-img" />
        <span class="logo-text">PORTAL TUR√çSTICO EC</span>
      </a>
      
      <nav class="nav" role="navigation" aria-label="Navegaci√≥n principal">
        <ul>
          <li><a href="/">Inicio</a></li>
          <li><a href="/rutas">Rutas</a></li>
          <li><a href="/contacto">Contacto</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main-content" role="main">
    <!-- Background decorativo -->
    <div class="registro-bg">
      <div class="bg-pattern"></div>
      <div class="floating-elements">
        <div class="float-elem elem-1"></div>
        <div class="float-elem elem-2"></div>
        <div class="float-elem elem-3"></div>
      </div>
    </div>
    
    <div class="registro-layout">
      <!-- Panel informativo lateral -->
      <div class="info-panel slide-in-left">
        <div class="panel-content">
          <div class="panel-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.8 12H3"></path>
            </svg>
          </div>
          <h2 class="panel-title">¬°Bienvenido de vuelta!</h2>
          <p class="panel-subtitle">Contin√∫a tu aventura por Ecuador</p>
          <ul class="benefits-list">
            <li class="benefit-item">
              <div class="benefit-icon">üéØ</div>
              <span>Acceso a rutas personalizadas</span>
            </li>
            <li class="benefit-item">
              <div class="benefit-icon">‚ù§Ô∏è</div>
              <span>Guarda tus destinos favoritos</span>
            </li>
            <li class="benefit-item">
              <div class="benefit-icon">üìç</div>
              <span>Historial de viajes</span>
            </li>
            <li class="benefit-item">
              <div class="benefit-icon">üåü</div>
              <span>Recomendaciones exclusivas</span>
            </li>
          </ul>
          <div class="stats-preview">
            <div class="stat-item">
              <span class="stat-number">150+</span>
              <span class="stat-label">Destinos</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">50K+</span>
              <span class="stat-label">Viajeros</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">4.9‚òÖ</span>
              <span class="stat-label">Valoraci√≥n</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Formulario principal -->
      <div class="form-wrapper slide-in-right">
        <div class="form-container-modern">
          <div class="form-header">
            <h1 class="form-title-modern">Iniciar Sesi√≥n</h1>
            <p class="form-subtitle">Accede a tu cuenta de viajero</p>
          </div>
          
          {% if mensaje %}
            <div class="notification {% if 'error' in mensaje.lower() %}error{% else %}success{% endif %} mb-3">
              <p>{{ mensaje }}</p>
            </div>
          {% endif %}
          
          <form method="POST" class="form-steps" role="form" aria-describedby="login-descripcion">
            <p id="login-descripcion" class="sr-only">Formulario para iniciar sesi√≥n en el portal tur√≠stico</p>
            
            <div class="step-panel active" data-step="1">
              <div class="form-group-modern">
                <label for="usuario" class="form-label-modern">
                  <span class="label-icon">üë§</span>
                  Usuario
                </label>
                <input type="text" id="usuario" name="usuario" class="form-input-modern" 
                       placeholder="Ingrese su nombre de usuario" required 
                       aria-describedby="usuario-error" autofocus />
                <div id="usuario-error" class="error-message" role="alert" aria-live="polite"></div>
              </div>
              
              <div class="form-group-modern">
                <label for="clave" class="form-label-modern">
                  <span class="label-icon">üîí</span>
                  Contrase√±a
                </label>
                <div class="password-input-wrapper">
                  <input type="password" id="clave" name="clave" class="form-input-modern" 
                         placeholder="Ingrese su contrase√±a" required 
                         aria-describedby="clave-error" />
                  <button type="button" class="password-toggle-btn" onclick="togglePassword('clave', this)" 
                          aria-label="Mostrar u ocultar contrase√±a">
                    <span class="icon-eye">üëÅÔ∏è</span>
                  </button>
                </div>
                <div id="clave-error" class="error-message" role="alert" aria-live="polite"></div>
              </div>
              
              <div class="form-options">
                <label class="checkbox-wrapper-modern">
                  <input type="checkbox" id="recordar" name="recordar" />
                  <span class="checkmark-modern"></span>
                  <span class="checkbox-text">Recordar mi sesi√≥n</span>
                </label>
              </div>
            </div>
            
            <div class="form-actions-modern">
              <button type="submit" class="btn-primary-modern full-width" id="submit-btn">
                <span class="btn-icon">üöÄ</span>
                <span class="btn-text">Iniciar Sesi√≥n</span>
                <div class="btn-loader" style="display: none;"></div>
              </button>
            </div>
            
            <div class="form-links">
              <p>¬øNo tienes cuenta? <a href="/registro" class="link-accent">Reg√≠strate aqu√≠</a></p>
              <p><a href="/recuperar" class="link-secondary">¬øOlvidaste tu contrase√±a?</a></p>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>Portal Tur√≠stico Ecuador</h3>
        <p>Descubre la belleza y diversidad de Ecuador con nuestro portal tur√≠stico inclusivo.</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 Portal Tur√≠stico Ecuador. Todos los derechos reservados.</p>
    </div>
  </footer>
  <script>
    let intentosLogin = 0;
    const maxIntentos = 3;
    let tiempoBloqueo = 0;
    
    function togglePassword(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.type === 'password') {
        input.type = 'text';
        btn.querySelector('.icon-eye').textContent = 'üôà';
      } else {
        input.type = 'password';
        btn.querySelector('.icon-eye').textContent = 'üëÅÔ∏è';
      }
    }

    // Funci√≥n para manejar intentos de login fallidos
    function manejarIntentoFallido() {
      intentosLogin++;
      
      if (intentosLogin >= maxIntentos) {
        bloquearFormulario();
      } else {
        mostrarAdvertencia();
      }
    }

    function mostrarAdvertencia() {
      const intentosRestantes = maxIntentos - intentosLogin;
      const mensaje = `Credenciales incorrectas. Te quedan ${intentosRestantes} intento(s) antes del bloqueo temporal.`;
      
      mostrarNotificacion(mensaje, 'warning');
    }

    function bloquearFormulario() {
      tiempoBloqueo = 300; // 5 minutos en segundos
      const form = document.querySelector('form');
      const submitBtn = form.querySelector('button[type="submit"]');
      
      form.style.pointerEvents = 'none';
      form.style.opacity = '0.6';
      
      submitBtn.disabled = true;
      submitBtn.textContent = `Bloqueado (${Math.floor(tiempoBloqueo / 60)}:${(tiempoBloqueo % 60).toString().padStart(2, '0')})`;
      
      mostrarNotificacion('Demasiados intentos fallidos. El formulario ha sido bloqueado por 5 minutos por seguridad.', 'error');
      
      const countdown = setInterval(() => {
        tiempoBloqueo--;
        
        if (tiempoBloqueo <= 0) {
          clearInterval(countdown);
          desbloquearFormulario();
        } else {
          submitBtn.textContent = `Bloqueado (${Math.floor(tiempoBloqueo / 60)}:${(tiempoBloqueo % 60).toString().padStart(2, '0')})`;
        }
      }, 1000);
    }

    function desbloquearFormulario() {
      const form = document.querySelector('form');
      const submitBtn = form.querySelector('button[type="submit"]');
      
      form.style.pointerEvents = 'auto';
      form.style.opacity = '1';
      submitBtn.disabled = false;
      submitBtn.textContent = 'Iniciar Sesi√≥n';
      
      intentosLogin = 0;
      mostrarNotificacion('El formulario ha sido desbloqueado. Puedes intentar de nuevo.', 'success');
    }

    function mostrarNotificacion(mensaje, tipo) {
      // Remover notificaci√≥n anterior si existe
      const notificacionAnterior = document.querySelector('.notification-security');
      if (notificacionAnterior) {
        notificacionAnterior.remove();
      }

      const notificacion = document.createElement('div');
      notificacion.className = `notification ${tipo} notification-security`;
      notificacion.innerHTML = `<p>${mensaje}</p>`;
      
      const form = document.querySelector('form');
      form.parentNode.insertBefore(notificacion, form);
      
      // Auto-ocultar despu√©s de 5 segundos para mensajes no cr√≠ticos
      if (tipo !== 'error') {
        setTimeout(() => {
          if (notificacion.parentNode) {
            notificacion.remove();
          }
        }, 5000);
      }
    }

    // Simular intento fallido para demostraci√≥n (esto normalmente vendr√≠a del servidor)
    document.querySelector('form').addEventListener('submit', function(e) {
      // Solo para demostraci√≥n - en realidad esto se manejar√≠a en el servidor
      if (tiempoBloqueo > 0) {
        e.preventDefault();
        return;
      }
      
      // Simulaci√≥n de verificaci√≥n (reemplazar con l√≥gica real)
      const usuario = document.getElementById('usuario').value;
      const clave = document.getElementById('clave').value;
      
      if (usuario === 'demo' && clave === 'demo123') {
        // Login exitoso - resetear intentos
        intentosLogin = 0;
      } else {
        // Para demostraci√≥n solamente
        e.preventDefault();
        manejarIntentoFallido();
      }
    });

    // Validaci√≥n en tiempo real
    document.getElementById('usuario').addEventListener('input', function() {
      validarCampo('usuario', this.value.length >= 3, 'El usuario debe tener al menos 3 caracteres');
    });

    document.getElementById('clave').addEventListener('input', function() {
      validarCampo('clave', this.value.length >= 6, 'La contrase√±a debe tener al menos 6 caracteres');
    });

    function validarCampo(campo, esValido, mensajeError) {
      const input = document.getElementById(campo);
      const errorDiv = document.getElementById(campo + '-error');
      
      if (!esValido) {
        input.style.borderColor = '#ef4444';
        errorDiv.textContent = mensajeError;
        errorDiv.style.display = 'block';
      } else {
        input.style.borderColor = '#22c55e';
        errorDiv.textContent = '';
        errorDiv.style.display = 'none';
      }
    }
  </script>
</body>
</html>
