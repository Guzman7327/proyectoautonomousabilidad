<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>B√∫squeda Avanzada de Destinos</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <main id="main-content" role="main">
    <div class="modal-content registro-modal" style="max-width:700px;margin:2rem auto;box-shadow:0 0 10px #0002;">
      <h2>B√∫squeda Avanzada de Destinos</h2>
      <form id="form-busqueda-filtros" action="/busqueda_avanzada" method="POST" role="form" aria-describedby="busqueda-descripcion" autocomplete="on">
        <p id="busqueda-descripcion" class="sr-only">Formulario de b√∫squeda avanzada con m√∫ltiples filtros</p>
        <!-- Filtros B√°sicos -->
        <div class="form-section" aria-labelledby="filtros-basicos-titulo">
          <h3 id="filtros-basicos-titulo" class="section-title">üéØ Filtros B√°sicos</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="busqueda-nombre" class="form-label">üè∑Ô∏è Nombre del Destino</label>
              <input type="text" id="busqueda-nombre" name="nombre" placeholder="Buscar por nombre..." autocomplete="off" class="form-input" list="sugerencias-nombres" />
              <datalist id="sugerencias-nombres">
                <option value="Centro Hist√≥rico de Cuenca">
                <option value="Playa de Salinas">
                <option value="Ba√±os de Agua Santa">
                <option value="Islas Gal√°pagos">
              </datalist>
            </div>
            <div class="form-group">
              <label for="busqueda-tipo" class="form-label">üèõÔ∏è Tipo de Destino</label>
              <select id="busqueda-tipo" name="tipo" class="form-input">
                <option value="">Todos los tipos</option>
                <option value="ciudad">Ciudad</option>
                <option value="playa">Playa</option>
                <option value="monta√±a">Monta√±a</option>
                <option value="selva">Selva</option>
                <option value="isla">Isla</option>
                <option value="parque">Parque Nacional</option>
                <option value="monumento">Monumento</option>
                <option value="museo">Museo</option>
                <option value="restaurante">Restaurante</option>
                <option value="hotel">Hotel</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="busqueda-provincia" class="form-label">üó∫Ô∏è Provincia</label>
              <select id="busqueda-provincia" name="provincia" class="form-input">
                <option value="">Todas las provincias</option>
                <option value="azuay">Azuay</option>
                <option value="guayas">Guayas</option>
                <option value="pichincha">Pichincha</option>
                <option value="manabi">Manab√≠</option>
                <option value="galapagos">Gal√°pagos</option>
                <option value="tungurahua">Tungurahua</option>
              </select>
            </div>
            <div class="form-group">
              <label for="busqueda-ciudad" class="form-label">üèôÔ∏è Ciudad</label>
              <input type="text" id="busqueda-ciudad" name="ciudad" placeholder="Buscar por ciudad..." autocomplete="off" class="form-input" />
            </div>
          </div>
        </div>
        <!-- Filtros de Caracter√≠sticas -->
        <div class="form-section" aria-labelledby="filtros-caracteristicas-titulo">
          <h3 id="filtros-caracteristicas-titulo" class="section-title">üè∑Ô∏è Caracter√≠sticas Especiales</h3>
          <div class="checkbox-group">
            <label class="checkbox-wrapper">
              <input type="checkbox" name="caracteristicas" value="accesible" />
              <span class="checkmark"></span>
              <span class="checkbox-text">Accesible para personas con discapacidad</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" name="caracteristicas" value="familiar" />
              <span class="checkmark"></span>
              <span class="checkbox-text">Apto para familias</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" name="caracteristicas" value="aventura" />
              <span class="checkmark"></span>
              <span class="checkbox-text">Turismo de aventura</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" name="caracteristicas" value="cultural" />
              <span class="checkmark"></span>
              <span class="checkbox-text">Turismo cultural</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" name="caracteristicas" value="naturaleza" />
              <span class="checkmark"></span>
              <span class="checkbox-text">Turismo de naturaleza</span>
            </label>
            <label class="checkbox-wrapper">
              <input type="checkbox" name="caracteristicas" value="gastronomico" />
              <span class="checkmark"></span>
              <span class="checkbox-text">Turismo gastron√≥mico</span>
            </label>
          </div>
        </div>
        <!-- Filtros de Precio -->
        <div class="form-section" aria-labelledby="filtros-precio-titulo">
          <h3 id="filtros-precio-titulo" class="section-title">üí∞ Rango de Precio</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="busqueda-precio-min" class="form-label">üìâ Precio M√≠nimo</label>
              <input type="number" id="busqueda-precio-min" name="precio_min" placeholder="0" min="0" class="form-input" />
            </div>
            <div class="form-group">
              <label for="busqueda-precio-max" class="form-label">üìà Precio M√°ximo</label>
              <input type="number" id="busqueda-precio-max" name="precio_max" placeholder="100" min="0" class="form-input" />
            </div>
          </div>
          <div class="form-group">
            <label for="busqueda-gratis" class="form-label">üé´ Incluir Gratuitos</label>
            <div class="radio-group">
              <label class="radio-wrapper">
                <input type="radio" name="incluir_gratis" value="si" checked />
                <span class="radio-mark"></span>
                <span class="radio-text">S√≠, incluir destinos gratuitos</span>
              </label>
              <label class="radio-wrapper">
                <input type="radio" name="incluir_gratis" value="no" />
                <span class="radio-mark"></span>
                <span class="radio-text">No, solo destinos con costo</span>
              </label>
            </div>
          </div>
        </div>
        <!-- Filtros de Ordenamiento -->
        <div class="form-section" aria-labelledby="filtros-orden-titulo">
          <h3 id="filtros-orden-titulo" class="section-title">üìä Ordenar Por</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="busqueda-orden" class="form-label">üîÑ Orden</label>
              <select id="busqueda-orden" name="orden" class="form-input">
                <option value="relevancia">Relevancia</option>
                <option value="precio-asc">Precio: Menor a Mayor</option>
                <option value="precio-desc">Precio: Mayor a Menor</option>
                <option value="nombre-asc">Nombre: A-Z</option>
                <option value="nombre-desc">Nombre: Z-A</option>
              </select>
            </div>
          </div>
        </div>
        <!-- Bot√≥n de env√≠o -->
        <div class="form-actions">
          <button type="submit" class="btn-registro-submit">üîç Buscar</button>
          <button type="button" onclick="limpiarFiltros()" class="btn-registro-cancel">Limpiar filtros</button>
        </div>
        <div id="busqueda-loader" style="display:none; text-align:center; margin-top:1em;">
          <span class="loader"></span> Buscando...
        </div>
        <div id="busqueda-status" class="registro-status" role="status" aria-live="polite">{{ mensaje }}</div>
      </form>
      <div id="resultados-busqueda">
        <!-- Aqu√≠ se mostrar√°n los resultados din√°micamente -->
        {% if resultados %}
        <h3 style="margin-top:2rem;">Resultados encontrados: <span id="cantidad-resultados">{{ resultados|length }}</span></h3>
        <table class="tabla-resultados" style="width:100%;margin-top:1rem;">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Tipo</th>
              <th>Provincia</th>
              <th>Ciudad</th>
              <th>Latitud</th>
              <th>Longitud</th>
              <th>Direcci√≥n</th>
            </tr>
          </thead>
          <tbody>
            {% for r in resultados %}
            <tr>
              <td>{{ r[0] }}</td>
              <td>{{ r[1] }}</td>
              <td>{{ r[2] }}</td>
              <td>{{ r[3] }}</td>
              <td>{{ r[4] }}</td>
              <td>{{ r[5] }}</td>
              <td>{{ r[6] }}</td>
              <td>{{ r[7] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% elif resultados is not none %}
        <p style="margin-top:2rem;">No se encontraron resultados.</p>
        {% endif %}
      </div>
    </div>
  </main>
  <style>
  .loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #00796B;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    display: inline-block;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>
  <script>
  // Limpiar filtros
  function limpiarFiltros() {
    document.getElementById('form-busqueda-filtros').reset();
  }

  // AJAX para b√∫squeda din√°mica
  const form = document.getElementById('form-busqueda-filtros');
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    document.getElementById('busqueda-loader').style.display = 'block';
    document.getElementById('resultados-busqueda').innerHTML = '';
    const datos = new FormData(form);
    fetch('/busqueda_avanzada', {
      method: 'POST',
      body: datos
    })
    .then(r => r.text())
    .then(html => {
      document.getElementById('busqueda-loader').style.display = 'none';
      // Extraer solo la tabla de resultados del HTML devuelto
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const resultados = doc.querySelector('#resultados-busqueda');
      if (resultados) {
        document.getElementById('resultados-busqueda').innerHTML = resultados.innerHTML;
      } else {
        document.getElementById('resultados-busqueda').innerHTML = '<p style="margin-top:2rem;">No se encontraron resultados.</p>';
      }
    });
  });
  </script>
</body>
</html> 