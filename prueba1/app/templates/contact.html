{% extends "base.html" %}

{% block title %}Contacto - Portal de Turismo Inclusivo{% endblock %}

{% block content %}
<div class="contact-page">
    <div class="container">
        <!-- Header de la página -->
        <section class="page-header" role="banner">
            <div class="header-content">
                <h1 class="page-title">Contacto</h1>
                <p class="page-description">
                    ¿Tienes preguntas, sugerencias o necesitas ayuda? Estamos aquí para ayudarte.
                    Nuestro equipo está comprometido con hacer el turismo más accesible para todos.
                </p>
            </div>
        </section>

        <div class="contact-content">
            <div class="contact-grid">
                <!-- Información de contacto -->
                <div class="contact-info-section">
                    <div class="contact-info-card">
                        <h2>Información de Contacto</h2>
                        
                        <div class="contact-methods">
                            <div class="contact-method">
                                <div class="contact-icon">
                                    <span aria-hidden="true">📞</span>
                                </div>
                                <div class="contact-details">
                                    <h3>Teléfono</h3>
                                    <p>
                                        <a href="tel:+593-2-123-4567" class="contact-link">
                                            +593 2 123-4567
                                        </a>
                                    </p>
                                    <p class="contact-note">Lunes a Viernes: 8:00 AM - 6:00 PM</p>
                                </div>
                            </div>
                            
                            <div class="contact-method">
                                <div class="contact-icon">
                                    <span aria-hidden="true">✉️</span>
                                </div>
                                <div class="contact-details">
                                    <h3>Email</h3>
                                    <p>
                                        <a href="mailto:info@turismoinclusivo.ec" class="contact-link">
                                            info@turismoinclusivo.ec
                                        </a>
                                    </p>
                                    <p class="contact-note">Respuesta en 24 horas</p>
                                </div>
                            </div>
                            
                            <div class="contact-method">
                                <div class="contact-icon">
                                    <span aria-hidden="true">📍</span>
                                </div>
                                <div class="contact-details">
                                    <h3>Dirección</h3>
                                    <p>Av. Amazonas N45-123</p>
                                    <p>Quito, Pichincha, Ecuador</p>
                                    <p class="contact-note">Oficina principal</p>
                                </div>
                            </div>
                            
                            <div class="contact-method">
                                <div class="contact-icon">
                                    <span aria-hidden="true">💬</span>
                                </div>
                                <div class="contact-details">
                                    <h3>WhatsApp</h3>
                                    <p>
                                        <a href="https://wa.me/593212345678" class="contact-link" target="_blank" rel="noopener">
                                            +593 99 123-4567
                                        </a>
                                    </p>
                                    <p class="contact-note">Atención 24/7</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Horarios de atención -->
                        <div class="business-hours">
                            <h3>Horarios de Atención</h3>
                            <div class="hours-grid">
                                <div class="hours-item">
                                    <span class="day">Lunes - Viernes</span>
                                    <span class="time">8:00 AM - 6:00 PM</span>
                                </div>
                                <div class="hours-item">
                                    <span class="day">Sábados</span>
                                    <span class="time">9:00 AM - 2:00 PM</span>
                                </div>
                                <div class="hours-item">
                                    <span class="day">Domingos</span>
                                    <span class="time">Cerrado</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Redes sociales -->
                        <div class="social-media">
                            <h3>Síguenos</h3>
                            <div class="social-links">
                                <a href="#" class="social-link" aria-label="Seguir en Facebook">
                                    <span aria-hidden="true">📘</span>
                                    Facebook
                                </a>
                                <a href="#" class="social-link" aria-label="Seguir en Twitter">
                                    <span aria-hidden="true">🐦</span>
                                    Twitter
                                </a>
                                <a href="#" class="social-link" aria-label="Seguir en Instagram">
                                    <span aria-hidden="true">📷</span>
                                    Instagram
                                </a>
                                <a href="#" class="social-link" aria-label="Seguir en YouTube">
                                    <span aria-hidden="true">📺</span>
                                    YouTube
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Formulario de contacto mejorado -->
                <div class="contact-form-section">
                    <div class="contact-form-card">
                        <h2>Envíanos un Mensaje</h2>
                        <p class="form-description">
                            Completa el formulario y nos pondremos en contacto contigo lo antes posible.
                            Todos los campos marcados con * son obligatorios.
                        </p>
                        
                        <form method="POST" class="contact-form" id="contact-form" novalidate>
                            <!-- Información personal -->
                            <div class="form-section">
                                <h3>Información Personal</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="first_name" class="form-label required">
                                            Nombre
                                            <span class="required-indicator" aria-label="Campo obligatorio">*</span>
                                        </label>
                                        <input type="text" 
                                               id="first_name" 
                                               name="first_name" 
                                               class="form-control"
                                               required
                                               autocomplete="given-name"
                                               aria-describedby="first_name-help first_name-error"
                                               placeholder="Tu nombre">
                                        <div id="first_name-help" class="form-help">
                                            Ingresa tu nombre completo
                                        </div>
                                        <div id="first_name-error" class="form-error" role="alert" aria-live="polite"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="last_name" class="form-label required">
                                            Apellido
                                            <span class="required-indicator" aria-label="Campo obligatorio">*</span>
                                        </label>
                                        <input type="text" 
                                               id="last_name" 
                                               name="last_name" 
                                               class="form-control"
                                               required
                                               autocomplete="family-name"
                                               aria-describedby="last_name-help last_name-error"
                                               placeholder="Tu apellido">
                                        <div id="last_name-help" class="form-help">
                                            Ingresa tu apellido completo
                                        </div>
                                        <div id="last_name-error" class="form-error" role="alert" aria-live="polite"></div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="email" class="form-label required">
                                        Email
                                        <span class="required-indicator" aria-label="Campo obligatorio">*</span>
                                    </label>
                                    <div class="input-group">
                                        <span class="input-icon" aria-hidden="true">✉️</span>
                                        <input type="email" 
                                               id="email" 
                                               name="email" 
                                               class="form-control"
                                               required
                                               autocomplete="email"
                                               aria-describedby="email-help email-error"
                                               placeholder="tu@email.com">
                                    </div>
                                    <div id="email-help" class="form-help">
                                        Usaremos este email para responderte
                                    </div>
                                    <div id="email-error" class="form-error" role="alert" aria-live="polite"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="phone" class="form-label">
                                        Teléfono
                                    </label>
                                    <div class="input-group">
                                        <span class="input-icon" aria-hidden="true">📞</span>
                                        <input type="tel" 
                                               id="phone" 
                                               name="phone" 
                                               class="form-control"
                                               autocomplete="tel"
                                               aria-describedby="phone-help phone-error"
                                               placeholder="+593 99 123-4567">
                                    </div>
                                    <div id="phone-help" class="form-help">
                                        Opcional - Para contacto más rápido
                                    </div>
                                    <div id="phone-error" class="form-error" role="alert" aria-live="polite"></div>
                                </div>
                            </div>
                            
                            <!-- Detalles del mensaje -->
                            <div class="form-section">
                                <h3>Detalles del Mensaje</h3>
                                
                                <div class="form-group">
                                    <label for="subject" class="form-label required">
                                        Asunto
                                        <span class="required-indicator" aria-label="Campo obligatorio">*</span>
                                    </label>
                                    <select id="subject" 
                                            name="subject" 
                                            class="form-control"
                                            required
                                            aria-describedby="subject-help subject-error">
                                        <option value="">Selecciona un asunto</option>
                                        <option value="general">Consulta General</option>
                                        <option value="destinations">Información de Destinos</option>
                                        <option value="accessibility">Accesibilidad</option>
                                        <option value="feedback">Sugerencias y Comentarios</option>
                                        <option value="technical">Problema Técnico</option>
                                        <option value="partnership">Alianzas y Colaboraciones</option>
                                        <option value="other">Otro</option>
                                    </select>
                                    <div id="subject-help" class="form-help">
                                        Selecciona el tema principal de tu mensaje
                                    </div>
                                    <div id="subject-error" class="form-error" role="alert" aria-live="polite"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="message" class="form-label required">
                                        Mensaje
                                        <span class="required-indicator" aria-label="Campo obligatorio">*</span>
                                    </label>
                                    <textarea id="message" 
                                              name="message" 
                                              class="form-control"
                                              rows="6"
                                              required
                                              aria-describedby="message-help message-error message-counter"
                                              placeholder="Escribe tu mensaje aquí..."></textarea>
                                    <div id="message-help" class="form-help">
                                        Describe tu consulta o comentario con detalle
                                    </div>
                                    <div id="message-counter" class="form-counter">
                                        <span id="message-count">0</span> / 1000 caracteres
                                    </div>
                                    <div id="message-error" class="form-error" role="alert" aria-live="polite"></div>
                                </div>
                            </div>
                            
                            <!-- Preferencias de contacto -->
                            <div class="form-section">
                                <h3>Preferencias de Contacto</h3>
                                
                                <div class="form-group">
                                    <label class="form-label">Método de contacto preferido</label>
                                    <div class="radio-group">
                                        <label class="radio-label">
                                            <input type="radio" 
                                                   name="contact_method" 
                                                   value="email" 
                                                   checked
                                                   aria-describedby="contact_method-help">
                                            <span class="radio-mark"></span>
                                            Email
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" 
                                                   name="contact_method" 
                                                   value="phone"
                                                   aria-describedby="contact_method-help">
                                            <span class="radio-mark"></span>
                                            Teléfono
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" 
                                                   name="contact_method" 
                                                   value="whatsapp"
                                                   aria-describedby="contact_method-help">
                                            <span class="radio-mark"></span>
                                            WhatsApp
                                        </label>
                                    </div>
                                    <div id="contact_method-help" class="form-help">
                                        Selecciona cómo prefieres que te contactemos
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" 
                                               name="newsletter" 
                                               id="newsletter"
                                               aria-describedby="newsletter-help">
                                        <span class="checkmark"></span>
                                        Suscribirme al boletín de noticias
                                    </label>
                                    <div id="newsletter-help" class="form-help">
                                        Recibe información sobre nuevos destinos y promociones
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" 
                                               name="urgent" 
                                               id="urgent"
                                               aria-describedby="urgent-help">
                                        <span class="checkmark"></span>
                                        Es una consulta urgente
                                    </label>
                                    <div id="urgent-help" class="form-help">
                                        Marca si necesitas una respuesta inmediata
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Verificación de seguridad -->
                            <div class="form-section">
                                <h3>Verificación de Seguridad</h3>
                                
                                <div class="form-group">
                                    <label for="captcha" class="form-label required">
                                        Verificación
                                        <span class="required-indicator" aria-label="Campo obligatorio">*</span>
                                    </label>
                                    <div class="captcha-container">
                                        <div class="captcha-question">
                                            <span id="captcha-question">¿Cuánto es 3 + 5?</span>
                                            <button type="button" 
                                                    class="captcha-refresh" 
                                                    aria-label="Generar nueva pregunta">
                                                <span aria-hidden="true">🔄</span>
                                            </button>
                                        </div>
                                        <input type="number" 
                                               id="captcha" 
                                               name="captcha" 
                                               class="form-control"
                                               required
                                               aria-describedby="captcha-help captcha-error"
                                               placeholder="Tu respuesta">
                                    </div>
                                    <div id="captcha-help" class="form-help">
                                        Resuelve la operación matemática para verificar que eres humano
                                    </div>
                                    <div id="captcha-error" class="form-error" role="alert" aria-live="polite"></div>
                                </div>
                            </div>
                            
                            <!-- Botones de acción -->
                            <div class="form-actions">
                                <button type="submit" 
                                        class="btn btn-primary btn-lg"
                                        id="submit-contact"
                                        aria-describedby="submit-help">
                                    <span class="btn-icon" aria-hidden="true">📤</span>
                                    Enviar Mensaje
                                    <span class="btn-loading" aria-hidden="true" style="display: none;">
                                        <span class="spinner"></span>
                                    </span>
                                </button>
                                
                                <button type="reset" 
                                        class="btn btn-outline-secondary"
                                        id="reset-contact"
                                        aria-describedby="reset-help">
                                    <span class="btn-icon" aria-hidden="true">🔄</span>
                                    Limpiar Formulario
                                </button>
                                
                                <div class="form-help-text">
                                    <div id="submit-help" class="help-text">
                                        Presiona Enter o haz clic para enviar tu mensaje
                                    </div>
                                    <div id="reset-help" class="help-text">
                                        Limpia todos los campos del formulario
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mensajes de estado -->
                            <div id="form-messages" class="form-messages" role="region" aria-live="polite"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- FAQ Section -->
        <section class="faq-section">
            <div class="faq-container">
                <h2>Preguntas Frecuentes</h2>
                <p class="faq-description">
                    Encuentra respuestas rápidas a las preguntas más comunes
                </p>
                
                <div class="faq-list">
                    <div class="faq-item">
                        <button class="faq-question" 
                                aria-expanded="false"
                                aria-controls="faq-answer-1">
                            <span class="faq-text">¿Cómo puedo reportar un problema de accesibilidad?</span>
                            <span class="faq-icon" aria-hidden="true">▼</span>
                        </button>
                        <div id="faq-answer-1" class="faq-answer" aria-hidden="true">
                            <p>Puedes reportar problemas de accesibilidad usando este formulario de contacto, 
                            seleccionando "Accesibilidad" como asunto. También puedes enviarnos un email 
                            directamente a accesibilidad@turismoinclusivo.ec</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <button class="faq-question" 
                                aria-expanded="false"
                                aria-controls="faq-answer-2">
                            <span class="faq-text">¿Cuánto tiempo tardan en responder?</span>
                            <span class="faq-icon" aria-hidden="true">▼</span>
                        </button>
                        <div id="faq-answer-2" class="faq-answer" aria-hidden="true">
                            <p>Nos comprometemos a responder todas las consultas en un máximo de 24 horas 
                            durante días laborables. Para consultas urgentes, puedes marcarlas en el formulario 
                            o contactarnos por WhatsApp.</p>
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <button class="faq-question" 
                                aria-expanded="false"
                                aria-controls="faq-answer-3">
                            <span class="faq-text">¿Puedo sugerir nuevos destinos?</span>
                            <span class="faq-icon" aria-hidden="true">▼</span>
                        </button>
                        <div id="faq-answer-3" class="faq-answer" aria-hidden="true">
                            <p>¡Por supuesto! Nos encanta recibir sugerencias de nuevos destinos. 
                            Puedes usar este formulario seleccionando "Sugerencias y Comentarios" como asunto, 
                            o enviarnos un email con los detalles del destino.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form');
    const messageField = document.getElementById('message');
    const messageCounter = document.getElementById('message-count');
    const captchaQuestion = document.getElementById('captcha-question');
    const captchaRefresh = document.querySelector('.captcha-refresh');
    
    // Contador de caracteres
    function updateMessageCounter() {
        const count = messageField.value.length;
        messageCounter.textContent = count;
        
        if (count > 900) {
            messageCounter.style.color = '#dc3545';
        } else if (count > 800) {
            messageCounter.style.color = '#ffc107';
        } else {
            messageCounter.style.color = '#6c757d';
        }
    }
    
    messageField.addEventListener('input', updateMessageCounter);
    
    // Generar captcha
    function generateCaptcha() {
        const num1 = Math.floor(Math.random() * 10) + 1;
        const num2 = Math.floor(Math.random() * 10) + 1;
        const operators = ['+', '-', '×'];
        const operator = operators[Math.floor(Math.random() * operators.length)];
        
        let answer;
        switch (operator) {
            case '+':
                answer = num1 + num2;
                break;
            case '-':
                answer = num1 - num2;
                break;
            case '×':
                answer = num1 * num2;
                break;
        }
        
        captchaQuestion.textContent = `¿Cuánto es ${num1} ${operator} ${num2}?`;
        captchaQuestion.dataset.answer = answer;
    }
    
    generateCaptcha();
    
    captchaRefresh.addEventListener('click', generateCaptcha);
    
    // Validación en tiempo real
    function validateField(field, type) {
        const value = field.value.trim();
        const errorElement = document.getElementById(field.id + '-error');
        let isValid = true;
        let errorMessage = '';
        
        field.classList.remove('is-invalid', 'is-valid');
        errorElement.textContent = '';
        
        if (field.hasAttribute('required') && !value) {
            isValid = false;
            errorMessage = 'Este campo es obligatorio';
        } else if (value) {
            switch (type) {
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(value)) {
                        isValid = false;
                        errorMessage = 'Por favor, ingresa un email válido';
                    }
                    break;
                    
                case 'phone':
                    const phoneRegex = /^[\+]?[0-9\s\-\(\)]{7,}$/;
                    if (!phoneRegex.test(value)) {
                        isValid = false;
                        errorMessage = 'Por favor, ingresa un número de teléfono válido';
                    }
                    break;
                    
                case 'captcha':
                    const userAnswer = parseInt(value);
                    const correctAnswer = parseInt(captchaQuestion.dataset.answer);
                    if (userAnswer !== correctAnswer) {
                        isValid = false;
                        errorMessage = 'Respuesta incorrecta. Intenta nuevamente.';
                    }
                    break;
            }
        }
        
        if (isValid) {
            field.classList.add('is-valid');
        } else {
            field.classList.add('is-invalid');
            errorElement.textContent = errorMessage;
        }
        
        return isValid;
    }
    
    // Eventos de validación
    const requiredFields = form.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        field.addEventListener('blur', () => {
            const type = field.type || 'text';
            validateField(field, type);
        });
        
        field.addEventListener('input', () => {
            if (field.classList.contains('is-invalid')) {
                const type = field.type || 'text';
                validateField(field, type);
            }
        });
    });
    
    // Validación especial para captcha
    document.getElementById('captcha').addEventListener('blur', () => {
        validateField(document.getElementById('captcha'), 'captcha');
    });
    
    // Envío del formulario
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validar todos los campos requeridos
        let isFormValid = true;
        requiredFields.forEach(field => {
            const type = field.type || 'text';
            if (!validateField(field, type)) {
                isFormValid = false;
            }
        });
        
        // Validar captcha
        if (!validateField(document.getElementById('captcha'), 'captcha')) {
            isFormValid = false;
        }
        
        if (isFormValid) {
            // Mostrar estado de carga
            const submitBtn = document.getElementById('submit-contact');
            submitBtn.disabled = true;
            submitBtn.querySelector('.btn-loading').style.display = 'inline-block';
            submitBtn.querySelector('.btn-icon').style.display = 'none';
            
            // Simular envío (aquí iría la lógica real)
            setTimeout(() => {
                showSuccessMessage('¡Mensaje enviado exitosamente! Te responderemos pronto.');
                form.reset();
                generateCaptcha();
                updateMessageCounter();
                
                submitBtn.disabled = false;
                submitBtn.querySelector('.btn-loading').style.display = 'none';
                submitBtn.querySelector('.btn-icon').style.display = 'inline-block';
            }, 2000);
        } else {
            // Enfocar el primer campo con error
            const firstError = form.querySelector('.is-invalid');
            if (firstError) {
                firstError.focus();
            }
        }
    });
    
    // Reset del formulario
    document.getElementById('reset-contact').addEventListener('click', function() {
        if (confirm('¿Estás seguro de que quieres limpiar todos los campos?')) {
            form.reset();
            generateCaptcha();
            updateMessageCounter();
            
            // Limpiar estados de validación
            form.querySelectorAll('.is-valid, .is-invalid').forEach(field => {
                field.classList.remove('is-valid', 'is-invalid');
            });
            
            form.querySelectorAll('.form-error').forEach(error => {
                error.textContent = '';
            });
        }
    });
    
    // FAQ Accordion
    const faqQuestions = document.querySelectorAll('.faq-question');
    faqQuestions.forEach(question => {
        question.addEventListener('click', function() {
            const isExpanded = this.getAttribute('aria-expanded') === 'true';
            const answer = document.getElementById(this.getAttribute('aria-controls'));
            
            // Cerrar otros FAQs
            faqQuestions.forEach(q => {
                if (q !== this) {
                    q.setAttribute('aria-expanded', 'false');
                    const otherAnswer = document.getElementById(q.getAttribute('aria-controls'));
                    otherAnswer.setAttribute('aria-hidden', 'true');
                }
            });
            
            // Toggle actual FAQ
            this.setAttribute('aria-expanded', !isExpanded);
            answer.setAttribute('aria-hidden', isExpanded);
        });
    });
    
    // Mostrar mensaje de éxito
    function showSuccessMessage(message) {
        const messagesContainer = document.getElementById('form-messages');
        const successDiv = document.createElement('div');
        successDiv.className = 'alert alert-success';
        successDiv.setAttribute('role', 'alert');
        successDiv.textContent = message;
        
        messagesContainer.appendChild(successDiv);
        
        // Remover después de 5 segundos
        setTimeout(() => {
            if (successDiv.parentNode) {
                successDiv.parentNode.removeChild(successDiv);
            }
        }, 5000);
    }
    
    // Anunciar a lectores de pantalla
    if (window.accessibility) {
        window.accessibility.announceToScreenReader('Página de contacto cargada. Usa Tab para navegar entre los campos del formulario.');
    }
});
</script>
{% endblock %} 